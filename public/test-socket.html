<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.io í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #1a1a2e;
            color: #e0e0e0;
        }
        .test-section {
            background-color: #16213e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        h1 {
            color: #e94560;
        }
        button {
            background-color: #e94560;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #c0354a;
        }
        .log {
            background-color: #0f3460;
            padding: 15px;
            border-radius: 5px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #1a1a2e;
        }
        .success {
            color: #4caf50;
        }
        .error {
            color: #f44336;
        }
        .info {
            color: #2196f3;
        }
    </style>
</head>
<body>
    <h1>ğŸ”Œ Socket.io í†µí•© í…ŒìŠ¤íŠ¸</h1>

    <div class="test-section">
        <h2>1. Socket.io ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <div id="connection-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>2. ê²Œì‹œê¸€ ì—…ë³´íŠ¸ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testUpvote()">ì—…ë³´íŠ¸ í…ŒìŠ¤íŠ¸</button>
        <div id="upvote-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>3. ê²Œì‹œê¸€ ë‹¤ìš´ë³´íŠ¸ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testDownvote()">ë‹¤ìš´ë³´íŠ¸ í…ŒìŠ¤íŠ¸</button>
        <div id="downvote-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>4. ëŒ“ê¸€ ì‘ì„± í…ŒìŠ¤íŠ¸</h2>
        <input type="text" id="comment-input" placeholder="ëŒ“ê¸€ ë‚´ìš©" style="width: 100%; padding: 10px; margin: 5px 0;">
        <button onclick="testComment()">ëŒ“ê¸€ ì‘ì„± í…ŒìŠ¤íŠ¸</button>
        <div id="comment-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>5. ì‹¤ì‹œê°„ ì•Œë¦¼ ë¡œê·¸</h2>
        <div id="realtime-log" class="log"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Socket.io í´ë¼ì´ì–¸íŠ¸ ì—°ê²°
        const socket = io();

        // ë¡œê·¸ ì¶œë ¥ í•¨ìˆ˜
        function addLog(elementId, message, type = 'info') {
            const logElement = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // ì—°ê²° í…ŒìŠ¤íŠ¸
        function testConnection() {
            socket.on('connect', () => {
                addLog('connection-log', 'âœ… Socket.io ì—°ê²° ì„±ê³µ!', 'success');
            });

            socket.on('disconnect', () => {
                addLog('connection-log', 'âŒ Socket.io ì—°ê²° ì¢…ë£Œ', 'error');
            });

            socket.on('connect_error', (error) => {
                addLog('connection-log', `âŒ ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
            });

            socket.on('post_upvoted', (data) => {
                addLog('realtime-log', `â¬†ï¸ ê²Œì‹œê¸€ ì—…ë³´íŠ¸: ${data.post.title}`, 'success');
            });

            socket.on('post_downvoted', (data) => {
                addLog('realtime-log', `â¬‡ï¸ ê²Œì‹œê¸€ ë‹¤ìš´ë³´íŠ¸: ${data.post.title}`, 'success');
            });

            socket.on('new_comment', (data) => {
                addLog('realtime-log', `ğŸ’¬ ìƒˆ ëŒ“ê¸€: ${data.comment.author} - ${data.comment.content.substring(0, 30)}...`, 'success');
            });

            socket.on('comment_removed', (data) => {
                addLog('realtime-log', `ğŸ—‘ï¸ ëŒ“ê¸€ ì‚­ì œ: ${data.commentId}`, 'success');
            });

            socket.on('new_post', (data) => {
                addLog('realtime-log', `ğŸ“ ìƒˆ ê²Œì‹œê¸€: ${data.post.title}`, 'success');
            });

            addLog('connection-log', 'ğŸ“¡ ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
        }

        // ì—…ë³´íŠ¸ í…ŒìŠ¤íŠ¸
        function testUpvote() {
            socket.emit('upvote_post', {
                postId: 1,
                post: testPost,
                userId: 'test_user',
                timestamp: new Date().toISOString()
            });
            addLog('upvote-log', 'ğŸ“¤ ì—…ë³´íŠ¸ ì´ë²¤íŠ¸ ì „ì†¡', 'info');
        }

        // ë‹¤ìš´ë³´íŠ¸ í…ŒìŠ¤íŠ¸
        function testDownvote() {
            socket.emit('downvote_post', {
                postId: 1,
                post: testPost,
                userId: 'test_user',
                timestamp: new Date().toISOString()
            });
            addLog('downvote-log', 'ğŸ“¤ ë‹¤ìš´ë³´íŠ¸ ì´ë²¤íŠ¸ ì „ì†¡', 'info');
        }

        // ëŒ“ê¸€ í…ŒìŠ¤íŠ¸
        function testComment() {
            const content = document.getElementById('comment-input').value;
            if (!content) {
                addLog('comment-log', 'âŒ ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            socket.emit('comment_created', {
                postId: 1,
                post: testPost,
                comment: {
                    id: 1,
                    post_id: 1,
                    parent_id: null,
                    content: content,
                    author: 'test_user',
                    score: 0,
                    created_at: new Date().toISOString()
                },
                userId: 'test_user',
                timestamp: new Date().toISOString()
            });
            addLog('comment-log', 'ğŸ“¤ ëŒ“ê¸€ ì‘ì„± ì´ë²¤íŠ¸ ì „ì†¡', 'info');
        }
    </script>
</body>
</html>